## Use D1 as an example ##

# quantification using featureCounts
awk 'OFS="\t" {print $1":"$2+1"-"$3, $1, $2+1, $3, "."}' Diffbind_nofilter_peakset.txt > Diffbind_peakset.saf
Rscript run-featurecounts.R -b clean_bams/D1_sorted.fbw.bam --saf Diffbind_peakset.saf -o counts/D1 1>logs/D1_run_feature_counts.log 2>&1

# TMM normalization
perl abundance_estimates_to_matrix.pl --est_method featureCounts --quant_files counts/count.fofn --out_prefix counts/atac 1>logs/create_count_matrix.log 2>&1

# Differential expression analysis
## run_DE_analysis.pl from Trinity-v2.15.1
perl run_DE_analysis.pl -m ../counts/atac.counts.matrix --method edgeR -s sample.info --contrasts contrasts.txt -o edgeR 1>logs/run_edgeR.log 2>&1

# Peak annotation with UROPA
uropa -i all.peaks.json
